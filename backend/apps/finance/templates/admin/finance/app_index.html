{% extends "admin/app_index.html" %}
{% load i18n dashboard_tags %}

{% block content %}
<div id="content-main">
    <!-- Premium Finance Dashboard Header -->
    <div
        style="margin-bottom: 30px; background: linear-gradient(135deg, #1e293b 0%, #334155 100%); padding: 30px; border-radius: 16px; color: white; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);">
        <h1 style="margin: 0; font-size: 28px; font-weight: 700; color: white; display: flex; align-items: center;">
            <span style="margin-right: 12px;">üìä</span> {% trans 'Finance Dashboard' %}
        </h1>
        <p style="margin: 8px 0 0 0; opacity: 0.8; font-size: 16px;">‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô (Real-time
            Statistics)</p>
    </div>

    {% get_finance_stats as stats %}

    <!-- Stats Grid -->
    <div
        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px;">
        <!-- GMV -->
        <div
            style="background: white; padding: 24px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <div
                style="color: #64748b; font-size: 13px; font-weight: 600; text-transform: uppercase; margin-bottom: 8px;">
                Total GMV</div>
            <div style="font-size: 24px; font-weight: 700; color: #0f172a;">‡∏ø{{ stats.total_gmv }}</div>
            <div style="margin-top: 8px; font-size: 12px; color: #10b981; font-weight: 500;">‚úì ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
        </div>

        <!-- Revenue -->
        <div
            style="background: white; padding: 24px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <div
                style="color: #64748b; font-size: 13px; font-weight: 600; text-transform: uppercase; margin-bottom: 8px;">
                Platform Revenue</div>
            <div style="font-size: 24px; font-weight: 700; color: #f59e0b;">‡∏ø{{ stats.total_revenue }}</div>
            <div style="margin-top: 8px; font-size: 12px; color: #f59e0b; font-weight: 500;">‚òÖ ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° 10%</div>
        </div>

        <!-- Pending -->
        <div
            style="background: white; padding: 24px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <div
                style="color: #64748b; font-size: 13px; font-weight: 600; text-transform: uppercase; margin-bottom: 8px;">
                Pending Payouts</div>
            <div style="font-size: 24px; font-weight: 700; color: #ef4444;">‡∏ø{{ stats.pending_payout_amount }}</div>
            <div style="margin-top: 8px; font-size: 12px; color: #ef4444; font-weight: 500;">‚è≥ {{
                stats.pending_payout_count }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏à‡πà‡∏≤‡∏¢</div>
        </div>

        <!-- Made -->
        <div
            style="background: white; padding: 24px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <div
                style="color: #64748b; font-size: 13px; font-weight: 600; text-transform: uppercase; margin-bottom: 8px;">
                Total Payouts Made</div>
            <div style="font-size: 24px; font-weight: 700; color: #10b981;">‡∏ø{{ stats.total_payouts_made }}</div>
            <div style="margin-top: 8px; font-size: 12px; color: #64748b;">üéØ ‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß {{ stats.total_payout_count }}
                ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
        </div>
    </div>

    <!-- Pending Payouts Table -->
    <div
        style="background: white; border-radius: 12px; border: 1px solid #e2e8f0; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
        <div
            style="padding: 20px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
            <h2 style="margin: 0; font-size: 18px; font-weight: 600;">üí∏ ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (Pending Payouts)</h2>
            <a href="/admin/campaigns/campaignapplication/?status__in=COMPLETED,READY_TO_PAY"
                style="font-size: 13px; color: #3b82f6; text-decoration: none; font-weight: 500;">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Üí</a>
        </div>

        <table style="width: 100%; border-collapse: collapse; text-align: left;">
            <thead>
                <tr style="background: #f8fafc; border-bottom: 1px solid #e2e8f0;">
                    <th
                        style="padding: 12px 20px; font-size: 12px; font-weight: 600; color: #64748b; text-transform: uppercase;">
                        Campaign</th>
                    <th
                        style="padding: 12px 20px; font-size: 12px; font-weight: 600; color: #64748b; text-transform: uppercase;">
                        Influencer</th>
                    <th
                        style="padding: 12px 20px; font-size: 12px; font-weight: 600; color: #64748b; text-transform: uppercase;">
                        Amount</th>
                    <th
                        style="padding: 12px 20px; font-size: 12px; font-weight: 600; color: #64748b; text-transform: uppercase;">
                        Net Payout</th>
                    <th
                        style="padding: 12px 20px; font-size: 12px; font-weight: 600; color: #64748b; text-transform: uppercase;">
                        Action</th>
                </tr>
            </thead>
            <tbody>
                {% get_pending_payouts_list as pending_jobs %}
                {% if pending_jobs %}
                {% for job in pending_jobs %}
                <tr style="border-bottom: 1px solid #f1f5f9;">
                    <td style="padding: 16px 20px;">
                        <div style="font-weight: 500; font-size: 14px;">{{ job.campaign_title }}</div>
                        <div style="font-size: 11px; color: #94a3b8; margin-top: 2px;">ID: {{ job.id_short }}...</div>
                    </td>
                    <td style="padding: 16px 20px; font-size: 14px;">{{ job.influencer_name }}</td>
                    <td style="padding: 16px 20px; font-size: 14px; font-family: monospace;">‡∏ø{{ job.gross_amount }}
                    </td>
                    <td
                        style="padding: 16px 20px; font-size: 14px; color: #10b981; font-weight: 600; font-family: monospace;">
                        ‡∏ø{{ job.net_payout }}</td>
                    <td style="padding: 16px 20px;">
                        <a href="/admin/campaigns/campaignapplication/{{ job.id }}/change/"
                            style="display: inline-block; padding: 6px 12px; background: #3b82f6; color: white; border-radius: 6px; font-size: 12px; text-decoration: none; font-weight: 500;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</a>
                    </td>
                </tr>
                {% endfor %}
                {% else %}
                <tr>
                    <td colspan="5" style="padding: 40px; text-align: center; color: #94a3b8;">
                        ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <hr style="margin: 40px 0; border: 0; border-top: 1px solid #e2e8f0;">

    <!-- Original Admin Models -->
    {% if app_list %}
    {% for app in app_list %}
    <div class="app-{{ app.app_label }} module" style="margin-bottom: 20px;">
        <table
            style="width: 100%; border: 1px solid #e2e8f0; border-radius: 8px; border-collapse: separate; border-spacing: 0;">
            <caption>
                <a href="{{ app.app_url }}" class="section"
                    title="{% blocktrans with name=app.name %}Models in the {{ name }} application{% endblocktrans %}">{{
                    app.name }}</a>
            </caption>
            {% for model in app.models %}
            <tr class="model-{{ model.object_name|lower }}">
                {% if model.admin_url %}
                <th scope="row"><a href="{{ model.admin_url }}">{{ model.name }}</a></th>
                {% else %}
                <th scope="row">{{ model.name }}</th>
                {% endif %}

                {% if model.add_url %}
                <td class="addlink"><a href="{{ model.add_url }}" class="addlink">{% trans 'Add' %}</a></td>
                {% else %}
                <td>&nbsp;</td>
                {% endif %}

                {% if model.admin_url %}
                {% if model.view_only %}
                <td class="viewlink"><a href="{{ model.admin_url }}" class="viewlink">{% trans 'View' %}</a></td>
                {% else %}
                <td class="changelink"><a href="{{ model.admin_url }}" class="changelink">{% trans 'Change' %}</a></td>
                {% endif %}
                {% else %}
                <td>&nbsp;</td>
                {% endif %}
            </tr>
            {% endfor %}
        </table>
    </div>
    {% endfor %}
    {% else %}
    <p>{% trans 'You don‚Äôt have permission to view or edit anything.' %}</p>
    {% endif %}
</div>
{% endblock %}